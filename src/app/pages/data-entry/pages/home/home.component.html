<div>
  <div class="row">
    <div
      class="col-md-12"
      *ngIf="
        (currentUser$ | async) &&
        (dataEntryFlowConfigs$ | async) &&
        (programMetadata$ | async) &&
        !isFormSet &&
        !formId
      "
    >
      <app-forms
        [currentUser]="currentUser$ | async"
        [dataEntryFlowConfigs]="dataEntryFlowConfigs$ | async"
        [programMetadata]="programMetadata$ | async"
        (selectedForm)="onSelectForm($event)"
        (dataEntryFlowAndForm)="onGetDataEntryFlowAndForm($event)"
      ></app-forms>
    </div>
    <div
      class="col-md-12"
      style="padding: 0 !important; margin-top: 15px"
      *ngIf="currentUserGroups && currentUserGroups.length > 0 && isFormSet"
    >
      <div style="width: 100%; margin-bottom: 15px">
        <button
          style="padding: 0px"
          mat-stroked-button
          (click)="showFormsList()"
          style="border: none"
        >
          <mat-icon style="margin-left: -15px">arrow_back</mat-icon>Back to the
          list
        </button>
      </div>
      <div style="margin-left: 3px;">
        <h4 style="text-align: center;">
          {{ selectedForm.name }}
        </h4>
      </div>
      <div style="min-width: 10%; float: left;">
        <!-- <ngx-dhis2-org-unit-filter
          [orgUnitFilterConfig]="orgUnitFilterConfig"
          [selectedOrgUnitItems]="selectedOrgUnitItems"
          (orgUnitUpdate)="onOrgUnitUpdate($event, 'UPDATE')"
          (orgUnitClose)="onOrgUnitUpdate($event, 'CLOSE')"
        >
        </ngx-dhis2-org-unit-filter> -->
        <ngx-dhis2-selection-filters
          [selectionFilterConfig]="selectionFilterConfig"
          (filterUpdate)="onFilterUpdate($event)"
          [dataSelections]="
            selectedOrgUnitItems.length > 0 ? selectedOrgUnitItems : []
          "
        >
        </ngx-dhis2-selection-filters>
      </div>
      <!-- <div style="width: 20%; float: left;">
        <div *ngIf="!(dataEntryFormsByOu$ | async) && selectedOu">
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </div>
        <select
          (change)="getEntryForm($event.target.value)"
          *ngIf="dataEntryFormsByOu$ | async"
          class="form-control"
          style="background-color: transparent;"
        >
          <option value="">Select form</option>
          <option [value]="form.id" *ngFor="let form of dataEntryForms">{{
            form.name
          }}</option>
        </select>
      </div> -->
      <div
        style="min-width: 10%; float: left; margin-left: 2%;"
        *ngIf="
          hasParentData &&
          trackedEntityInstances.length > 0 &&
          !isReportSet &&
          selectedOu
        "
      >
        <select
          class="form-control"
          (change)="createDataObject($event.target.value, dataEntryFlowConfigs)"
          [(ngModel)]="dataEntrySelections.batchNo"
          style="background-color: transparent;"
        >
          <option value="">Select batch</option>
          <option
            [value]="trackedEntityInstance['trackedEntityInstance']"
            *ngFor="let trackedEntityInstance of trackedEntityInstances"
            >{{ trackedEntityInstance['created'] | date }}</option
          >
        </select>
      </div>
      <div
        style="min-width: 10%; float: left; margin-left: 10px;"
        *ngIf="
          ((selectedDataEntryForm && dataEntrySelections.batchNo != '') ||
            (selectedDataEntryForm && !hasParentData)) &&
          !isReportSet &&
          selectedOu
        "
      >
        <input
          type="date"
          class="form-control"
          [(ngModel)]="dataEntrySelections.selectedDate"
        />
      </div>
      <div>
        <a
          [ngClass]="{ 'toggle-btn-active': isReportSet == false }"
          (click)="unSetReport()"
          style="float: right; cursor: pointer;"
          >DataEntry</a
        >
        <a
          [ngClass]="{ 'toggle-btn-active': isReportSet == true }"
          (click)="setReport()"
          style="float: right; margin-right: 8px; cursor: pointer;"
          >List Report</a
        >
      </div>
    </div>
    <!-- {{ dataElements$ | async | json }} -->
    <div
      class="col-md-12"
      style="padding: 0 !important;margin-top: 15px;"
      *ngIf="!isReportSet && isFormSet"
    >
      <div
        *ngIf="
          (dataElements$ | async) &&
          (dataElements$ | async)?.trackedEntityAttributes &&
          dataEntrySelections.selectedDate &&
          isDefaultDataSet &&
          isFormSet &&
          selectedOu
        "
      >
        <app-data-entry
          [dataEntryForm]="selectedDataEntryForm"
          [formName]="selectedProgram['name']"
          [formId]="selectedProgram['id']"
          [dataElements]="(dataElements$ | async)['trackedEntityAttributes']"
          [formType]="formType"
          [elementsDataValues]="elementsDataValues"
          (entryInfo)="entryInfo($event)"
        ></app-data-entry>
      </div>
      <div
        *ngIf="
          hasParentData &&
          dataEntrySelections.selectedDate &&
          !isDefaultDataSet &&
          isFormSet &&
          selectedOu
        "
      >
        <app-data-entry
          [dataEntryForm]="selectedDataEntryForm"
          [formName]="selectedProgram['name']"
          [formId]="selectedProgram['id']"
          [dataElements]="dataElements"
          [formType]="formType"
          [elementsDataValues]="elementsDataValues"
          (entryInfo)="entryInfo($event)"
        ></app-data-entry>
      </div>
    </div>
    <div
      class="col-md-12"
      *ngIf="atLeastOneDataEntered && !isReportSet && isFormSet"
    >
      <button
        class="btn btn-success"
        style="float: left; margin-top: 15px;"
        (click)="saveData()"
      >
        Save
      </button>
    </div>
    <div
      class="col-md-12"
      *ngIf="isReportSet && entityAttributeHeaders.length > 0 && isFormSet"
      style="margin-top: 15px; width: 100%; overflow: auto"
    >
      <app-events-list
        [dataValues]="eventValues"
        [headers]="entityAttributeHeaders"
      ></app-events-list>
    </div>
    <div
      class="col-md-12"
      *ngIf="
        isReportSet &&
        (eventsForReports$ | async) &&
        (eventsForReports$ | async)?.events
      "
      style="overflow: auto;"
    >
      <app-render-events
        [events]="(eventsForReports$ | async)?.events"
        [dataElements]="dataElements"
        [reportListHeaders]="reportListHeaders"
        (eventSet)="onEventSet($event)"
      ></app-render-events>
    </div>
  </div>
</div>
<div *ngIf="viewEvent && isReportSet && currentEvent">
  <app-data-entry
    [dataEntryForm]="selectedDataEntryForm"
    [formName]="selectedProgram['name']"
    [formId]="selectedProgram['id']"
    [dataElements]="dataElements"
    [formType]="formType"
    [elementsDataValues]="elementsDataValues"
    (entryInfo)="entryInfo($event)"
  ></app-data-entry>

  <button
    class="btn btn-primary"
    style="float: left; margin-top: 15px;"
    (click)="onDeleteEvent()"
  >
    Delete
  </button>
</div>
